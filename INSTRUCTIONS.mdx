# HOC User Session

### ğŸ’¡ ProtÃ©ger des routes avec un HOC

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Nous avons maintenant une `session` qui permet de rÃ©cupÃ©rer un `user` connectÃ©. Nous avons crÃ©Ã© la fonction `getConnectedUser` (que nous avons dÃ©placÃ©e dans `dal.ts`) qui nous permet de dÃ©tecter si un `user` est connectÃ© et de gÃ©rer lâ€™affichage en fonction, exemple :

```tsx
function Page() {
  const user = await getConnectedUser()
  return (
    <div className="mx-auto max-w-2xl space-y-8 p-6 text-center text-lg">
      {user ? (
        <Label>Hello {user.email}</Label>
      ) : (
        <Label>You are not connected</Label>
      )}
    </div>
  )
}
export default Page
```

Ce qui revient Ã 

```tsx
function Page() {
  const user = await getConnectedUser()
  if (!user) {
    return <Label>You are not connected</Label>
  }

  return (
    <div className="mx-auto max-w-2xl space-y-8 p-6 text-center text-lg">
      <Label>Hello {user.email}</Label>
    </div>
  )
}
export default Page
```

On pourrait ajouter ce bout de code dans toutes nos routes protÃ©gÃ©es

```tsx
const user = await getConnectedUser()
if (!user) {
  return <Label>You are not connected</Label>
}
```

Mais on va toujours dupliquer beaucoup de code, ce qui rend la maintenance compliquÃ©e (Ne respecte pas le principe `DRY`: [Don't Repeat Yourself](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself))

Pour protÃ©ger nos routes, nous allons utiliser un [HOC : High Order Component](https://blog.logrocket.com/understanding-react-higher-order-components/) . Les 3 points dâ€™un `HOC` :

- 1. RÃ©utilisation de la Logique des Composants.
- 2. Manipulation des `Props`.
- 3. Abstraction et DÃ©couplage.

Exemple :

```tsx
import React, { useState, useEffect } from 'react';

const withEnhancement = (BaseComponent) => {
 // HOC logic using hooks
 return function EnhancedComponent(props) {
   // HOC-specific logic using hooks
   return (
     <BaseComponent {...props} enhancedProp="someValue" />
   );
 };
};
//utilisation
function NormalComponent {return <></>}
return withEnhancement(NormalComponent)
```

## Exercice

**ğŸ¶** Dans cet exercice, tu vas devoir crÃ©er un `HOC` qui aura pour but de :

- RÃ©cupÃ©rer le user connectÃ© avec `getConnectedUser`.
- Afficher : `You are not connected` si pas de `user`.
- Injecter le `props user` au composant afin quâ€™il puisse Ãªtre utilisÃ©.

ğŸ¶ Utilise ensuite ce HOC dans `/auth/page` et les routes protÃ©gÃ©es.

Fichiers

- `exercise/auth/lib/withAuth.tsx`
- `exercise/auth/page.tsx`

## Bonus

### 1. ğŸš€ ProtÃ©ger les routes `dashboard` et `bank-account`

**ğŸ¶** ProtÃ¨ge les routes `dashboard` et `bank-account` avec le `HOC`.

**ğŸ¶** Ajoute Ã©galement le `HOC` sur `Logout` car on doit Ãªtre connectÃ© pour pouvoir `logout`.

Fichiers

- `exercise/bank-account/page`
- `exercise/dashboard/page`
- `exercise/dashboard/logout`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://blog.logrocket.com/understanding-react-higher-order-components/](https://blog.logrocket.com/understanding-react-higher-order-components/)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=05.Next%20Auth&entry.533578441=06%20HOC%20User%20Session).
