Strategy Pattern

### ğŸ’¡ Comprendre Strategy Pattern

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans le dÃ©veloppement de logiciels, il est souvent nÃ©cessaire de pouvoir modifier le comportement d'un objet sans changer son code source. C'est lÃ  que le pattern Strategy intervient. Ce pattern permet de dÃ©finir une famille d'algorithmes, de les encapsuler individuellement et de les rendre interchangeables. Cela permet de varier l'algorithme ou la logique utilisÃ©e par un objet sans altÃ©rer son fonctionnement global.

Le pattern Strategy est particuliÃ¨rement utile dans les situations oÃ¹ plusieurs algorithmes pour effectuer une tÃ¢che sont disponibles et oÃ¹ l'algorithme Ã  utiliser peut varier en fonction du contexte. Ce pattern favorise Ã©galement la rÃ©utilisabilitÃ© du code et la sÃ©paration des prÃ©occupations.

### Exemple Pratique dans Next.js

Pour illustrer le pattern Strategy, prenons l'exemple de la gestion des sessions utilisateur dans une application Next.js. Selon l'environnement ou les exigences spÃ©cifiques, vous pouvez choisir de gÃ©rer les sessions de maniÃ¨re **stateless** (sans Ã©tat) ou en les stockant dans une **base de donnÃ©es**. Le pattern Strategy permet de basculer entre ces deux mÃ©thodes de maniÃ¨re transparente.

### DÃ©finition des StratÃ©gies

Nous avons developper deux stratÃ©gies pour la gestion des sessions :

1. **Stateless** : Les sessions sont gÃ©rÃ©es sans Ã©tat, souvent Ã  l'aide de JSON Web Tokens (JWT).
2. **Database** : Les sessions sont stockÃ©es dans une base de donnÃ©es.

Nous avons des fonctions spÃ©cifiques pour chaque mÃ©thode de gestion des sessions :

- `createSession`
- `verifySession`
- `updateSession`
- `deleteSession`

Chacune de ces fonctions a une implÃ©mentation pour chaque stratÃ©gie.

### ImplÃ©mentation du Pattern Strategy

Lâ€™idÃ©e est que les couches qui appellent les fonctions de sessions nâ€™ont pas a ce prÃ©occuper du type de gestion de session.

Pour cela nous allons interdire ce type dâ€™import spÃ©cifique

```tsx
//âŒ
import {createSession, deleteSession} from './session-database'
//âŒ
import {createSession, deleteSession} from './session-stateless'

// Mais on autorise
//âœ…
import {createSession, deleteSession} from './session'
```

Il est possible de dÃ©finir des rÃ¨gles au niveau du `linter` pour interdire ces imports

```json
//.eslintrc.json
"no-restricted-imports": [
      "error",
      {
        "paths": [
          {
            "name": "./session-stateless",
            "importNames": ["createSession", "deleteSession", "verifySession"],
            "message": "Do not import these session management functions from this module."
          },
          {
            "name": "./session-database",
            "importNames": ["createSession", "deleteSession", "verifySession"],
            "message": "Do not import these session management functions from this module."
          }
        ]
      }
    ]
```

## Exercice

Dans cet exercice tu as un type Ã  disposition : `SessionType`

```tsx
export enum SessionType {
  STATELESS = 'STATELESS',
  DATABASE = 'DATABASE',
}
```

Et le type de session sera dÃ©finis en variable dâ€™environnement

```json
SESSION_TYPE=DATABASE
```

Pour dÃ©terminer le type il suffira de faire dans notre fichier `session.ts`

```tsx
const SESSION_TYPE: SessionType = process.env.SESSION_TYPE as SessionType
```

Pour les besoins de lâ€™exercice nous avons modifier tous les imports de sessions dans `auth.ts et dal.ts` et nous avons maintenant un fichier `sessions.ts` qui appelle la version stateless

```tsx
export async function createSession(userId: string) {
  return await createSessionStateLess(userId)
}
export async function verifySession() {
  return await verifySessionStateless()
}
export async function updateSession() {
  return await updateSessionStateLess()
}

export function deleteSession() {
  return deleteSessionStateLess()
}
```

- **ğŸ¶ ImplÃ©mente le stategy pattern pour pouvoir switcher dâ€™implementation en fonction de** `SESSION_TYPE` dÃ©fini dans le `.env`

ps : pense Ã  tester tous les cas de types de sessions

```tsx
//.env
SESSION_TYPE=DATABASE
SESSION_TYPE=STATELESS
SESSION_TYPE=
```

Fichiers

- `exercise/auth/lib/session.ts`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://en.wikipedia.org/wiki/Strategy_pattern](https://en.wikipedia.org/wiki/Strategy_pattern)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=5.Next%20Auth&entry.533578441=09-stategy-pattern).
