# Credentials - Persistance - Encryption

### ğŸ’¡ Persistance de credentials (encryption)

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Dans les sections prÃ©cÃ©dentes nous avons crÃ©Ã© des `routes / form / actions` mockÃ©s Ã  la librairie dâ€™authentification.

![archi](/course/form-action-lib-db.png)

Nous allons donc maintenant implÃ©menter la librairie dâ€™authentification. Cette couche aura pour role de gÃ©rer la logique dâ€™encryption du mot de passe et insertion en base de donnÃ©es. Ensuite la lecture et la vÃ©rification du credencials (email/mot de passe)

### Introduction aux Credentials et au Hachage des Mots de Passe

Lors de la mise en place d'un systÃ¨me d'authentification, il est crucial de garantir la sÃ©curitÃ© des informations sensibles des utilisateurs, notamment les mots de passe. Pour ce faire, nous utilisons des techniques de hachage et de salage afin de protÃ©ger les mots de passe stockÃ©s dans la base de donnÃ©es.

### Credentials

Les credentials (ou identifiants) dÃ©signent gÃ©nÃ©ralement l'ensemble des informations utilisÃ©es pour vÃ©rifier l'identitÃ© d'un utilisateur. Cela inclut typiquement un nom d'utilisateur (ou email) et un mot de passe. Ces informations permettent Ã  un systÃ¨me de dÃ©terminer si un utilisateur est autorisÃ© Ã  accÃ©der Ã  des ressources spÃ©cifiques.

### Hachage et Salage des Mots de Passe

Le hachage est un processus cryptographique qui transforme un mot de passe en une chaÃ®ne de caractÃ¨res unique, appelÃ©e "hash". Ce processus est unidirectionnel, ce qui signifie qu'il est pratiquement impossible de rÃ©cupÃ©rer le mot de passe original Ã  partir du hash. Pour renforcer davantage la sÃ©curitÃ©, nous ajoutons un "sel" (salt) au mot de passe avant de le hacher.

Le salage est l'ajout d'une valeur alÃ©atoire unique Ã  chaque mot de passe avant de le hacher. Cela empÃªche les attaquants d'utiliser des tables de hachage prÃ©-calculÃ©es (ou "rainbow tables") pour deviner les mots de passe.

Voici un exemple de code utilisant `bcrypt` pour hacher et saler un mot de passe :

```tsx
const bcrypt = require('bcrypt');
const saltRounds = 10;

// GÃ©nÃ©ration du sel avec un nombre de tours spÃ©cifiÃ©
const salt = await bcrypt.genSalt(saltRounds);

// Hachage du mot de passe avec le sel
const hashedPassword = await bcrypt.hash(password, salt);

console.log('Mot de passe hachÃ© :', hashedPassword);

```

## Exercice

Dans cette exercice nous allons implÃ©menter `signIn` et `signUp,` pour cela nous avons deja des fonction permettant de lire et dâ€™accÃ©der Ã  notre base de donnÃ©es

```tsx
import {addUser, getUserByEmail} from '@/db/sgbd'
```

SpÃ©cification des 2 fonctions

- `signIn` (fonction de crÃ©ation de compte)
  1. VÃ©rification du user en BDD (`getUserByEmail`)
  2. `Error` si lâ€™utilisateur existe dÃ©jÃ 
  3. GÃ©nÃ©ration dâ€™un `SALT`
  4. Hash du mot de passe avec `bcrypt.hash`
  5. CrÃ©ation du user en BDD(`addUser`)
  6. Retourne le user crÃ©Ã©
- `signUp` (fonction de connexion)
  1. RÃ©cupÃ©ration de lâ€™utilisateur en BDD (`getUserByEmail`)
  2. `Error` si lâ€™utilisateur nâ€™existe pas
  3. Comparaison des mots de passes avec `bcrypt.compare`
  4. Retourne le user trouvÃ© ou `SignInError`

**ğŸ¶ ImplÃ©mente cela dans le fichier `auth.ts`**

- Teste la crÃ©ation de compte
- La connexion
- Les erreurs (doublons et user inexistant)

<aside>
ğŸ’¡ Tu peux supprimer le fichier `src/db/db.json` pour reset les users en BDD. Par default : [a@a.fr](mailto:a@a.fr) avec le mot de passe `a` existe.

</aside>

Fichiers

- `exercise/auth/lib/auth.ts`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://nextjs.org/docs/app/building-your-application/authentication#authentication](https://nextjs.org/docs/app/building-your-application/authentication#authentication)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=5.Next%20Auth&entry.533578441=03%20persistance-hash-salt).
